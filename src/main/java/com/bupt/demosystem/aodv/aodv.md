[搜索] [ txt | html | pdf | 中文提供] [追踪] [ WG ] [电子邮件] [ DIFF1 ] [ DIFF2 ] [尼特]

来自：draft-ietf-manet-aodv-13 实验 网络工作组 C. Perkins 征求意见：3561 诺基亚研究中心 类别：实验性 E. Belding-Royer 加州大学圣巴巴拉分校 达斯 辛辛那提大学 2003 年 7
月

            Ad hoc 点播距离矢量 (AODV) 路由

本备忘录的状态

本备忘录定义了互联网的实验协议 社区。它没有指定任何类型的 Internet 标准。 请求讨论和改进建议。 本备忘录的分发不受限制。

版权声明

版权所有 (C) 互联网协会 (2003)。版权所有。

抽象的

Ad hoc On-Demand Distance Vector (AODV) 路由协议是 旨在供自组织网络中的移动节点使用。它提供 快速适应动态链路条件，低处理和 内存开销，网络利用率低，决定单播 路由到自组织网络内的目的地。它用
目标序列号以确保始终自由循环 （即使面对路由控制消息的异常传递）， 避免与以下相关的问题（例如“计数到无穷大”） 经典的距离矢量协议。

    目录
    
    1 . 简介 .....................................................   2
    2 . 概述 ................................................. .   3
    3 . AODV 术语 .....................................................   4
    4 . 适用性声明 .....................................   6
    5 . 消息格式 .....................................................   7
    5.1 . 路由请求 (RREQ) 消息格式 .....................   7
    5.2 . 路由回复 (RREP) 消息格式 .....................   8
    5.3 . 路由错误 (RERR) 消息格式 ..................... 10
    5.4. 路由应答确认 (RREP-ACK) 消息格式 .. 11
    6 . AODV 操作 ..................................................... 11
    6.1 . 维护序列号 ..................................... 11
    6.2 . 路由表条目和前体列表 ..................... 13
    6.3 . 生成路由请求 ..................................... 14 
    6.4 . 控制路由请求消息的传播... 15 
    6.5．处理和转发路由请求 ..................................... 16 
    6.6．生成路由回复 ..................................... 18 
        6.6.1 . 目的地生成路由回复...... 18
        6.6.2. 由中间人生成路由回复
               节点 ..................................... 19 
        6.6.3 . 生成无偿 RREP ...................................... 19 
    6.7 . 接收和转发路由回复 ..................... 20 
    6.8．单向链路上的操作 ..................... 21 
    6.9 . Hello 消息 ..................................................... 22 
    6.10维护本地连接...... ...................... 23
    6.11 路由错误 (RERR) 消息、路由到期和路由
        删除 ..................................................... 24 
    6.12本地修复 ..................................................... 26 
    6.13重启后的动作...... ...................................... 27 
    6.14接口 ..................... ...................... 28 
    7 . AODV 和聚合网络 ..................................... 28
    8 . 将 AODV 与其他网络一起使用 ..................................... 29
    9 . 扩展 ..................................... 30
    9.1 . Hello 间隔扩展格式 ..................... 30
    10. 配置参数 ..................................... 31
    11 . 安全注意事项 ..................................... 33
    12 . IANA 考虑事项 ..................................... 34
    13 . IPv6 注意事项 ..................................................... 34
    14 . 致谢 ..................................................... 34
    15 . 规范性参考文献 ..................................... 35
    16 . 参考资料 ..................................... 35
    17 . 作者地址 ..................................... 36
    18. 完整的版权声明 ..................................................... 37

1 . 介绍

Ad hoc On-Demand Distance Vector (AODV) 算法使 参与移动设备之间的动态、自启动、多跳路由 希望建立和维护自组织网络的节点。AODV 允许移动节点快速获取新目的地的路线，
并且不需要节点维护到目的地的路由 没有在积极的沟通。AODV 允许移动节点响应 及时链路断线和网络拓扑变化。 AODV 的操作是无循环的，并且通过避免 Bellman-Ford “计数到无穷大”问题提供了快速收敛 hoc
网络拓扑变化（通常，当一个节点在网络中移动时 网络）。当链接断开时，AODV 会导致受影响的节点集 得到通知，以便他们能够使用 失去链接。

珀金斯等。阿尔。实验 [第 2 页]

RFC 3561 AODV 路由 2003 年 7 月

AODV 的一个显着特点是它使用目的地 每个路由条目的序列号。目的地序列 号码是由目的地创建的，与任何 它发送给请求节点的路由信息​​。使用目的地 序列号确保循环自由并且易于编程。 给定到目的地的两条路线之间的选择，请求
要求节点选择序列号最大的那个。

2 . 概述

路由请求 (RREQ)、路由回复 (RREP) 和路由错误
(RERR) 是 AODV 定义的消息类型。这些消息类型 通过 UDP 接收，并应用正常的 IP 报头处理。所以， 例如，请求节点应该使用它的 IP 地址 作为消息的发起方 IP 地址。广播用 消息，使用 IP 限制广播地址 (
255.255.255.255)。 这意味着不会盲目转发此类消息。然而， AODV 操作确实需要某些消息（例如 RREQ） 广泛传播，也许在整个 ad hoc 网络中传播。这 此类 RREQ 的传播范围由 IP 标头。通常不需要分段。

只要通信连接的端点有效 路由到对方，AODV 没有任何作用。当一个路由到 需要新的目的地，节点广播一个RREQ来寻找路由 到目的地。当 RREQ 到达时可以确定路由 目的地本身，或具有“新鲜”的中间节点
足够'到达目的地的路线。“足够新鲜”的路线是有效的 关联序列号为目的地的路由条目 至少与 RREQ 中包含的一样大。路线已定 可以通过将 RREP 单播返回到 RREQ 的发起方来获得。 收到请求的每个节点缓存一条返回发起者的路由
请求，以便可以从目的地单播 RREP 沿着通往该发起者的路径，或同样从任何中间 能够满足请求的节点。

节点监视活动路由中下一跳的链路状态。当一个 检测到活动路由中的链路中断，RERR 消息用于 通知其他节点该链路已发生丢失。RERR 消息指示那些没有的目的地（可能是子网） 通过断开的链接可以更长时间地到达。为了启用这个
报告机制，每个节点都有一个“前体列表”，包含 每个可能使用它的邻居的 IP 地址 前往每个目的地的下一跳。前身中的信息 列表在生成的过程中最容易获得 一个 RREP 消息，根据定义它必须被发送到一个节点 前体清单（见第 6.6 节）。如果
RREP 有一个非零前缀

珀金斯等。阿尔。实验 [第 3 页]

RFC 3561 AODV 路由 2003 年 7 月

长度，然后是请求 RREP 的 RREQ 的发起者 信息包含在子网路由的前体中 （并非专门针对特定目的地）。

也可以接收多播 IP 地址的 RREQ。在这 文档，未指定对此类消息的完整处理。为了 例如，多播 IP 地址的这种 RREQ 的发起者可能 必须遵守特殊规则。但是，重要的是要启用 非中间节点的正确多播操作 启用作为 IP
多播的始发节点或目标节点 地址，同样没有配备任何特殊的多播 协议处理。对于这种不知道多播的节点，处理 对于作为目标 IP 地址的多播 IP 地址必须是 以与任何其他目标 IP 地址相同的方式执行。

AODV 是一个路由协议，它处理路由表管理。 即使对于短期路由，也必须保留路由表信息， 例如被创建来临时存储指向节点的反向路径 发起 RREQ。AODV 对每条路线使用以下字段 表条目：

- 目标 IP 地址
- 目的地序列号
- 有效的目标序列号标志
- 其他状态和路由标志（例如，有效、无效、可修复、 正在维修）
- 网络接口
- 跳数（到达目的地所需的跳数）
- 下一跳
- 前体列表（在第 6.2 节中描述）
- 生命周期（路由的到期或删除时间）

管理序列号对于避免路由循环至关重要， 即使链接中断并且节点不再可访问以提供其 自己的序列号信息。目的地变成 当链接断开或停用时无法访问。当这些 条件发生时，该路线因涉及的操作而无效 序列号并将路由表条目状态标记为
无效的。有关详细信息，请参阅第 6.1 节。

3 . AODV 术语

本协议规范使用常规含义 [ 1 ] 表示 大写的词，如 MUST、SHOULD 等，表示要求 各种协议功能的级别。本节定义了其他
[ 3 ] 中尚未定义的与 AODV 一起使用的术语。

珀金斯等。阿尔。实验 [第 4 页]

RFC 3561 AODV 路由 2003 年 7 月

      活动路线

         通往具有路由表条目的目的地的路由
         标记为有效。只能使用活动路由
         转发数据包。

      播送

         广播是指传输到 IP 有限广播
         地址，255.255.255.255。广播数据包可能不是
         盲目转发，但广播有助于启用
         在整个 ad hoc 网络中传播 AODV 消息。

      目的地

         数据包要传输到的 IP 地址。
         与“目标节点”相同。一个节点知道它是目的地
         一个典型数据包的节点，当它的地址出现在
         IP 报头的适当字段。目的地路线
         节点由 AODV 协议的动作提供，其中
         在路由中携带所需目的节点的IP地址
         发现消息。

      转发节点

         同意转发发往另一个节点的数据包的节点
         节点，通过将它们重传到更接近的下一跳
         沿已使用设置的路径的单播目的地
         路由控制消息。

      前进路线

         为从一个节点发送数据包而设置的路由
         向其所需目的地的路由发现操作。

      无效路线

         已过期的路由，由无效状态表示
         路由表条目。一个无效的路由被用来存储
         之前有效的路线信息在很长一段时间内
         时间。不能使用无效路由转发数据包，
         但它可以提供对路线修复有用的信息，并且
         也用于未来的 RREQ 消息。

      始发节点

         发起 AODV 路由发现消息的节点
         处理并可能由广告中的其他节点重新传输
         临时网络。比如发起路由的节点
         发现过程和广播RREQ消息被称为
         RREQ 消息的发起节点。

      反向路线

         为转发回复 (RREP) 数据包而设置的路由
         来自目的地或中间节点的发​​起者
         有到达目的地的路线。

      序列号

         每个保持单调递增的数字
         始发节点。在AODV路由协议消息中，
         被其他节点用来确定新鲜度
         来自始发节点的信息。

      有效路线

         请参阅活动路线。

4 . 适用性声明

AODV 路由协议是为移动自组织网络设计的 数以万计的移动节点。AODV可以处理 低、中和相对高的流动率，以及 各种数据流量级别。AODV 设计用于网络 节点都可以相互信任，无论是通过使用 预配置的密钥，或者因为已知没有
恶意入侵者节点。AODV 旨在减少 传播控制流量并消除数据开销 流量，以提高可扩展性和性能。

珀金斯等。阿尔。实验 [第 6 页]

RFC 3561 AODV 路由 2003 年 7 月

5 . 消息格式

5.1 . 路由请求 (RREQ) 消息格式

        0 1 2 3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    
    ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 类型 |J|R|G|D|U| 保留 | 跳数 |
    ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | RREQ ID |
    ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 目标 IP 地址 |
    ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 目标序列号 |
    ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 发起方 IP 地址 |
    ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 始发者序列号 |
    ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+

Route Request 消息的格式如上所示，并且 包含以下字段：

      类型 1

      J 加入标志；为多播保留。

      R 修复标志；为多播保留。

      G 免费 RREP 标志；表示是否一个
                     无偿的 RREP 应该单播到节点
                     在目标 IP 地址字段中指定（请参阅
                     部分6.3，6.6.3）。

      D 仅目的地标志；仅表示
                     目的地可能会响应此 RREQ（请参阅
                     第 6.5 节）。

      U 未知序列号；表示目的地
                     序列号未知（参见第 6.3 节）。

      保留 发送为 0；接待时被忽略。

      Hop Count 从发起方 IP 地址开始的跳数
                     到处理请求的节点。


      RREQ ID 唯一标识
                     与特定的 RREQ 结合使用时
                     始发节点的 IP 地址。

      目标 IP 地址
                     路由的目的地的 IP 地址
                     是需要的。

      目标序列号
                     过去收到的最新序列号
                     由始发者为任何通往
                     目的地。

      发起者 IP 地址
                     发起该节点的 IP 地址
                     路由请求。

      始发者序列号
                     要在路由中使用的当前序列号
                     指向路由发起者的入口
                     要求。

5.2 . 路由回复 (RREP) 消息格式

    0 1 2 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 类型 |R|A| 保留 |前缀 Sz| 跳数 |
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 目标IP地址|
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 目标序列号 |
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 发起方 IP 地址 |
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 终身 |
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+

Route Reply 消息的格式如上所示，并且 包含以下字段：

      类型 2

      R 修复标志；用于多播。

      需要确认；见第5.4和6.7节。

      保留 发送为 0；接待时被忽略。

      前缀大小 如果非零，则 5 位前缀大小指定
                    指示的下一跳可用于任何节点
                    相同的路由前缀（由 Prefix 定义
                    大小）作为请求的目的地。

      Hop Count 从发起方 IP 地址开始的跳数
                    到目标 IP 地址。对于组播路由
                    请求这表明跳数
                    组播树成员发送 RREP。

      目标 IP 地址
                    路由的目的地的 IP 地址
                    提供。

      目标序列号
                    与目标关联的序列号
                    路线。

      发起者 IP 地址
                    发起 RREQ 的节点的 IP 地址
                    为其提供路线。

      Lifetime 节点接收的时间（以毫秒为单位）
                    RREP 认为路由是有效的。

请注意，前缀大小允许子网路由器提供路由 对于路由前缀定义的子网中的每个主机， 由子网路由器的 IP 地址和前缀决定 尺寸。为了利用此功能，子网路由器必须 保证对共享指定子网的所有主机的可达性 字首。有关详细信息，请参阅第 7
节。当前缀大小非零时， 任何路由信息（和前体数据）必须与 关于子网路由，而不是单个目标 IP 该子网上的地址。

当发送 RREP 消息的链路时使用“A”位 可能不可靠或单向。当 RREP 消息包含
'A' 位被设置，RREP 的接收者应该返回一个 RREP-ACK 消息。见第 6.8 节。

珀金斯等。阿尔。实验 [第 9 页]

RFC 3561 AODV 路由 2003 年 7 月

5.3 . 路由错误 (RERR) 消息格式

    0 1 2 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 类型 |N| 保留 | 目的地计数 |
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 无法访问的目标 IP 地址 (1) |
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 无法到达的目标序列号 (1) |
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- +-+-+-+-+-+-+-| | 其他无法访问的目标 IP 地址（如果需要）|
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ |其他无法访问的目标序列号（如果需要）|
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+

路由错误消息的格式如上所示，以及 包含以下字段：

      类型 3

      N 无删除标志；在节点执行本地操作时设置
                  修复一个链接，上游节点不应删除
                  路线。

      保留 发送为 0；接待时被忽略。

      DestCount 包含在不可达目的地的数量
                  信息; 必须至少为 1。

      无法访问的目标 IP 地址
                  已成为目的地的 IP 地址
                  由于链接中断而无法访问。

      无法到达的目标序列号
                  路由表条目中的序列号
                  前一个 Unreachable 中列出的目的地
                  目标 IP 地址字段。

每当链路中断导致一个或多个时发送 RERR 消息 某些节点的邻居无法到达目的地。有关如何维护适当的信息， 请参见第 6.2 节 此测定的记录，以及第 6.11 节的规格 关于如何创建目的地列表。

珀金斯等。阿尔。实验性 [第 10 页]

RFC 3561 AODV 路由 2003 年 7 月

5.4 . 路由应答确认 (RREP-ACK) 消息格式

路由应答确认（RREP-ACK）消息必须在 对设置了“A”位的 RREP 消息的响应（参见第 5.2 节）。 这通常在存在单向链接的危险时进行 阻止路由发现周期的完成（参见第 6.8节）。

    0 1
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5

++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ | 类型 | 保留 | ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      类型 4

      保留 发送为 0；接待时被忽略。

6 . AODV操作

本节介绍节点生成Route的场景 请求 (RREQ)、路由回复 (RREP) 和路由错误 (RERR) 消息 用于向目的地进行单播通信，以及消息如何 数据进行处理。为了正确处理消息， 必须在路由表中维护某些状态信息 感兴趣的目的地的条目。

所有 AODV 消息都使用 UDP 发送到端口 654。

6.1 . 维护序列号

每个节点的每个路由表条目必须包含最新的 有关 IP 地址的序列号的可用信息 为其维护路由表条目的目标节点。 这个序列号被称为“目标序列号”。它 每当节点收到新的（即，非陈旧的）信息时更新 关于可能来自 RREQ、RREP 或 RERR
消息的序列号 接收到与该目的地相关的信息。AODV取决于每个节点 在网络中拥有并维护其目标序列号 保证通往该节点的所有路由的无环路。一种 目标节点将自己的序列号增加两个 情况：

- 在节点发起路由发现之前，它必须 增加它自己的序列号。这可以防止与 先前建立的通往发起者的反向路由 请求。

- 紧接在目的地节点发起 RREP 之前 响应一个 RREQ，它必须更新它自己的序列号到 其当前序列号和目的地的最大值 RREQ 数据包中的序列号。

当目的地增加它的序列号时，它必须这样做 将序列号值视为无符号数。 完成序列号翻转，如果序列号有 已经被分配为可表示的最大可能数 作为 32 位无符号整数（即 4294967295），那么当它是 增加后，它的值将为零 (0)。在另一
手，如果序列号当前的值为 2147483647， 如果 2 的补码，这是最大可能的正整数 算术用于 32 位整数，下一个值将是 2147483648，它是同一个中最负可能的整数 编号系统。负数的表示不是 与 AODV
序列号的增量有关。这是在 对比两个 AODV 比较结果的方式 序列号将被处理（见下文）。

为了确定有关目的地的信息不是 stale，节点比较其当前序列的数值 编号与从传入的 AODV 消息中获得的编号。这 必须使用有符号的 32 位算术进行比较，这是 完成序列号翻转所必需的。如果结果是 从值中减去当前存储的序列号
传入的序列号小于零，则信息 必须丢弃 AODV 消息中与该目的地相关的信息， 因为与节点当前的信息相比，该信息是陈旧的 存储的信息。

节点可能改变的唯一其他情况 其路由表条目之一中的目标序列号在 对到下一跳的丢失或过期链接的响应 目的地。节点确定哪些目的地使用特定的 通过查询其路由表来确定下一跳。在这种情况下，对于每个 使用下一跳的目的地，节点递增序列
编号并将路由标记为无效（另请参见第6.11和6.12节）。 每当任何足够新鲜（即包含序列号在 至少等于记录的序列号）路由信息 一个受影响的目的地被一个节点接收，该节点已标记为 路由表条目无效，节点应该更新其路由表 信息根据更新中包含的信息。

珀金斯等。阿尔。实验性 [第 12 页]

RFC 3561 AODV 路由 2003 年 7 月

一个节点可以改变路由表项中的序列号 目的地只有在：

- 它本身就是目标节点，并提供了一条新的路线 本身，或

- 它收到一条 AODV 消息，其中包含有关 目标节点的序列号，或

- 通往目标节点的路径到期或中断。

6.2 . 路由表条目和前体列表

当一个节点收到来自邻居的 AODV 控制包时，或 创建或更新特定目的地或子网的路由，它 检查其路由表中是否存在目的地条目。在里面 如果该目的地没有相应的条目，则 条目已创建。序列号要么由 控制包中包含的信息，否则有效
序列号字段设置为false。只有在以下情况下才会更新路线 新的序列号是

(i) 高于路由中的目的序列号 表，或

(ii) 序列号相等，但跳数（的跳数） 新信息）加一，比现有的跃点小 在路由表中计数，或

(iii) 序列号未知。

路由表条目的 Lifetime 字段要么确定 来自控制包，或者它被初始化为 ACTIVE_ROUTE_TIMEOUT。此路由现在可用于发送任何排队的 数据包并完成任何未完成的路由请求。

每次使用路由转发数据包时，其 Active Route 源、目的和下一跳的生命周期字段 到目的地的路径更新为不小于当前 时间加上 ACTIVE_ROUTE_TIMEOUT。由于每个人之间的路线 预计始发者和目的地对是对称的，
前一跳的活动路由生命周期，沿反向路径 回IP源，也更新为不低于当前 时间加上 ACTIVE_ROUTE_TIMEOUT。Active Route 的生命周期是 每次使用路由时都会更新，无论是否 目标是单个节点或子网。

珀金斯等。阿尔。实验性 [第 13 页]

RFC 3561 AODV 路由 2003 年 7 月

对于节点作为路由表条目维护的每条有效路由， 该节点还维护一个可能正在转发的前体列表 此路由上的数据包。这些前体将收到通知 在检测到下一跳丢失的情况下从节点 关联。路由表条目中的前体列表包含那些 生成或转发路由回复的相邻节点。

6.3 . 生成路由请求

节点在确定需要路由时发布 RREQ 到一个目的地并且没有可用的。这可能发生，如果 节点以前不知道目的地，或者如果以前 到目的地的有效路由过期或被标记为无效。这 RREQ 消息中的目标序列号字段是最后一个 此目标的已知目标序列号并被复制
来自路由表中的目标序列号字段。如果 没有已知的序列号，未知序列号标志必须是 放。RREQ 消息中的发起方序列号是 节点自己的序列号，在插入前递增 在 RREQ 中。RREQ ID 字段从最后一个增加一 当前节点使用的 RREQ
ID。每个节点只维护一个 RREQ ID。跳数字段设置为零。

在广播 RREQ 之前，发起节点缓存 RREQ RREQ 的 ID 和发起方 IP 地址（它自己的地址） PATH_DISCOVERY_TIME。这样，当节点收到数据包时 再次从它的邻居那里，它不会重新处理和重新转发 包。

发起节点通常期望具有双向 与目标节点的通信。在这种情况下，它不是 足以让始发节点有一条到 目的节点；目的地也必须有一条返回目的地的路线 始发节点。为了使这尽可能有效地发生 可能，中间节点生成任何 RREP（如 第 6.6 节)
传送到始发节点应该是 伴随着一些动作，通知目的地有关 路由回原始节点。发起节点选择 这种操作模式在中间节点通过设置'G'
旗帜。请参阅第 6.6.3 节了解有关 中间节点响应设置了“G”标志的 RREQ。

一个节点不应该产生超过 RREQ_RATELIMIT RREQ 消息 每秒。广播 RREQ 后，节点等待 RREP（或 其他控制消息，其中包含有关到 适当的目的地）。如果没有收到路由 NET_TRAVERSAL_TIME
毫秒后，节点可能会再次尝试发现一个 通过广播另一个 RREQ 路由，最多可达 RREQ_RETRIES

珀金斯等。阿尔。实验性 [第 14 页]

RFC 3561 AODV 路由 2003 年 7 月

最大 TTL 值的次数。每次新尝试必须递增和 更新 RREQ ID。对于每次尝试，IP 标头的 TTL 字段 根据第 6.4 节中指定的机制设置，以便 能够控制 RREQ 的传播范围 重试。

等待路由的数据包（即在一个路由之后等待一个 RREP RREQ 已发送）应该被缓冲。缓冲应该是 “先进先出”（FIFO）。如果路由发现已经 在最大 TTL 下尝试 RREQ_RETRIES 次但没有收到任何
RREP，所有发往相应目的地的数据包 应该从缓冲区中删除并且目标不可达 消息应该传递给应用程序。

为了减少网络拥塞，源节点的重复尝试 在单个目的地的路由发现必须使用二进制 指数退避。源节点第一次广播 RREQ， 它等待 NET_TRAVERSAL_TIME 毫秒以接收 RREP。 如果在该时间内未收到 RREP，则源节点发送一个 新的
RREQ。在计算之后等待 RREP 的时间时 发送第二个 RREQ，源节点必须使用二进制 指数退避。因此，RREP 的等待时间 第二个RREQ对应的是2 * NET_TRAVERSAL_TIME 毫秒。如果在这段时间内没有收到 RREP，
可以发送另一个 RREQ，最多 RREQ_RETRIES 次额外尝试 在第一个 RREQ 之后。对于每一次额外的尝试，等待时间 因为 RREP 乘以 2，所以时间符合 二元指数退避。

6.4 . 控制路由请求消息的传播

为了防止 RREQ 在网络范围内不必要的传播， 发起节点应该使用扩展环搜索技术。在 扩展环搜索，始发节点最初使用 TTL = RREQ 数据包 IP 标头中的 TTL_START 并设置超时 接收到 RING_TRAVERSAL_TIME
毫秒的 RREP。 RING_TRAVERSAL_TIME 的计算方法如第 10 节所述。这 用于计算 RING_TRAVERSAL_TIME 的 TTL_VALUE 设置为等于 IP 报头中 TTL 字段的值。如果 RREQ 超时
没有相应的 RREP，发起者广播 RREQ 再次以 TTL_INCREMENT 递增 TTL。这继续 直到 RREQ 中设置的 TTL 达到 TTL_THRESHOLD，超过该值 TTL = NET_DIAMETER 用于每次尝试。每次超时
接收 RREP 的时间是 RING_TRAVERSAL_TIME。当需要 让所有重试遍历整个 ad hoc 网络，这可以是 通过将 TTL_START 和 TTL_INCREMENT 都配置为 与 NET_DIAMETER 相同的值。

珀金斯等。阿尔。实验性 [第 15 页]

RFC 3561 AODV 路由 2003 年 7 月

存储在无效路由表条目中的跳数指示 到路由表中该目的地的最后已知跳数。什么时候 稍后需要一条通往同一目的地的新路线 （例如，在路由丢失时），RREQ IP 报头中的 TTL 最初是 设置为跳数加上 TTL_INCREMENT。此后，按照每个
超时 TTL 递增 TTL_INCREMENT 直到 TTL = 已达到 TTL_THRESHOLD。除此之外，使用 TTL = NET_DIAMETER。 一旦 TTL = NET_DIAMETER，则设置等待 RREP 的超时时间 到
NET_TRAVERSAL_TIME，如第 6.3 节中所述。

过期的路由表条目不应该在之前被删除
(current_time + DELETE_PERIOD)（见第 6.11 节）。否则， 与路由对应的软状态（例如，最后已知的跳数） 会迷路。此外，更长的路由表条目删除时间 可以配置。任何等待 RREP 的路由表条目都应该 在 (
current_time + 2 * NET_TRAVERSAL_TIME) 之前不会被清除。

6.5 . 处理和转发路由请求

当一个节点收到一个 RREQ 时，它首先创建或更新一个路由到 没有有效序列号的前一跳（参见第 6.2 节） 然后检查以确定它是否收到了相同的 RREQ 发起者 IP 地址和 RREQ ID 至少在最后一个
PATH_DISCOVERY_TIME。如果已经收到这样的 RREQ，则节点 默默地丢弃新收到的 RREQ。剩下的这个 小节描述了为未被丢弃的 RREQ 采取的行动。

首先，它首先将 RREQ 中的跳跃计数值加一，以 考虑通过中间节点的新跃点。然后节点 搜索到发起方 IP 地址的反向路由（请参阅 第 6.2 节），使用最长前缀匹配。如果需要，路线 使用来自源的创建者序列号创建或更新 RREQ
在其路由表中。如果 节点收到返回给发起 RREQ 的节点的 RREP （由发起方 IP 地址标识）。当反向路由是 创建或更新，路由上的以下操作也 执行：

1. 将来自 RREQ 的发起方序列号与 路由表条目中对应的目标序列号 如果大于现有值，则复制

2.有效序列号字段设置为true；

3. 路由表中的下一跳成为节点 收到 RREQ（从源 IP 地址中获取） IP 标头，通常不等于发起方 IP 地址 RREQ 消息中的字段）；

珀金斯等。阿尔。实验性 [第 16 页]

RFC 3561 AODV 路由 2003 年 7 月

4、从RREQ消息中的Hop Count中复制hop count；

每当收到 RREQ 消息时，反向的 Lifetime 发起方 IP 地址的路由条目设置为最大值
(ExistingLifetime, MinimalLifetime)，其中

      MinimalLifetime = (当前时间 + 2*NET_TRAVERSAL_TIME -
                           2*HopCount*NODE_TRAVERSAL_TIME）。

当前节点可以使用反向路由转发数据包 与路由表中的任何其他路由相同。

如果一个节点没有生成 RREP（按照 第 6.6 节），如果传入的 IP 标头的 TTL 大于 1， 节点更新并广播 RREQ 到地址 255.255.255.255 在其配置的每个接口上（参见第 6.14 节）。更新 RREQ，出站 IP
报头中的 TTL 或跳数限制字段是 减一，RREQ 消息中的 Hop Count 字段为 增加 1，以考虑通过新的跃点 中间节点。最后，目标序列号 请求的目的地设置为相应的最大值 在 RREQ 消息中收到的值，以及目标序列
节点当前为请求的目的地维护的值。 但是，转发节点不得修改其维护的值 目标序列号，即使在 传入的 RREQ 大于当前由 转发节点。

否则，如果节点确实生成了 RREP，则该节点丢弃 请求。请注意，如果中间节点回复每个传输 对于特定目的地的 RREQ，结果可能是 目的地不会收到任何发现消息。在这 在这种情况下，目的地没有获知到目的地的路线 来自 RREQ
消息的始发节点。这可能会导致 目的地启动路由发现（例如，如果 发起者正在尝试建立 TCP 会话）。为了使 目的地学习到始发节点的路由， 发起节点应该在 RREQ 如果由于任何原因目的地可能需要一条路线 始发节点。如果响应带有“G”标志的
RREQ 设置，一个中间节点返回一个 RREP，它也必须单播一个 免费 RREP 到目标节点（参见第 6.6.3 节）。

珀金斯等。阿尔。实验性 [第 17 页]

RFC 3561 AODV 路由 2003 年 7 月

6.6 . 生成路由回复

在以下情况下，节点会生成 RREP：

(i) 它本身就是目的地，或

(ii) 它有一条到达目的地的活动路线，目的地 节点现有路由表条目中的序列号 因为目的地是有效的并且大于或等于 RREQ 的目标序列号（比较 使用有符号的 32 位算术）和“仅目的地”
('D') 标志未设置。

在生成 RREP 消息时，节点复制 Destination IP RREQ 消息中的地址和发起方序列号 RREP 消息中的相应字段。处理略 不同，取决于节点本身是否是请求的 目的地（见第 6.6.1 节），或者如果它是一个中间
具有到达目的地的足够新路由的节点（参见第 6.6.2节）。

一旦创建，RREP 将单播到下一跳 RREQ 的发起者，如路由表条目所示 那个鼻祖。由于 RREP 被转发回节点 发起 RREQ 消息，Hop Count 字段增加 每跳一个。因此，当 RREP 到达发起者时，
跳数表示目的地与目的地的距离（以跳为单位） 发起人。

6.6.1 . 目的地生成路由回复

如果生成节点是目的地本身，它必须递增 如果 RREQ 中的序列号，则将其自己的序列号加一 数据包等于该增量值。否则， 目标在生成之前不会更改其序列号 RREP 消息。目标节点将其（可能是新的 递增）序列号到目标序列号 RREP 字段，并在
Hop Count 字段中输入值零 的 RREP。

目标节点将值 MY_ROUTE_TIMEOUT（参见第 10节）复制到 RREP 的 Lifetime 字段中。每个节点可以重新配置 它的 MY_ROUTE_TIMEOUT 值，在轻度约束内（参见第 10节）。

珀金斯等。阿尔。实验性 [第 18 页]

RFC 3561 AODV 路由 2003 年 7 月

6.6.2 . 中间节点生成路由回复

如果生成 RREP 的节点不是目的节点，而是 取而代之的是沿从发起者到的路径的中间跳跃 目的地，它复制其已知的序列号 目的地到 RREP 中的目的地序列号字段 信息。

中间节点通过放置 最后一跳节点（从它接收到 RREQ，如 IP 标头中的源 IP 地址字段）到前体列表中 前向路由条目——即目标 IP 的条目 地址。中间节点也更新它的路由表条目 对于发起 RREQ 的节点，将下一跳指向
反向路由条目的前体列表中的目的地—— 即，RREQ 的发起方 IP 地址字段的条目 消息数据。

中间节点将其距离以跳数表示 目的地（由路由表中的跳数表示） Count RREP 中的字段。RREP 的 Lifetime 字段由下式计算 从其路由的到期时间中减去当前时间 表项。

6.6.3 . 生成免费的 RREP

节点收到 RREQ 并以 RREP 响应后，丢弃 RREQ。如果 RREQ 设置了“G”标志，并且中间 节点向发起节点返回一个 RREP，它也必须单播一个 到目标节点的免费 RREP。无偿的 RREP 是 要发送到所需目的地包含以下值 在
RREP 消息字段中：

跳数 跳数如 节点的路由表条目 鼻祖

Destination IP Address 节点的 IP 地址 发起 RREQ

目标序列号 始发者序列号来自 RREQ

发起方 IP 地址 目的地的 IP 地址 RREQ 中的节点

珀金斯等。阿尔。实验性 [第 19 页]

RFC 3561 AODV 路由 2003 年 7 月

Lifetime 路由的剩余生命周期 对于 RREQ 的发起者， 如中间节点所知。

然后将免费的 RREP 发送到沿路径的下一跳 目标节点，就好像目标节点已经 为发起节点发出了一个 RREQ，这个 RREP 是在 对该（虚构的）RREQ 的响应。发送到 无论“G”位是否设置，RREQ 的发起者都是相同的。

6.7 . 接收和转发路由回复

当一个节点收到一个 RREP 消息时，它会搜索（使用最长的 前缀匹配）用于到前一跳的路由。如果需要，路线 为前一跳创建，但没有有效的序列号 （见第 6.2 节）。接下来，节点然后增加跳数 RREP 中的值加一，以说明通过
中间节点。将此增量值称为“新跳数”。 如果没有，则创建此目的地的前向路由 已经存在。否则，节点比较 Destination Sequence 带有自己存储的目标序列号的消息中的编号 对于 RREP 消息中的目标 IP 地址。经比较，
现有条目仅在以下情况下更新：

(i) 路由表中的序号标记为 在路由表条目中无效。

(ii) RREP 中的 Destination Sequence Number 大于 节点的目标序列号的副本和 已知值有效，或

(iii) 序列号相同，但路由是 标记为不活动，或

(iv) 序列号相同，New Hop Count 为 小于路由表项中的跳数。

如果创建或更新到目的地的路由表条目， 然后发生以下操作：

- 路线被标记为活动，

- 目标序列号被标记为有效，

- 路由条目中的下一跳被分配为来自 收到RREP，由源IP指示 IP 标头中的地址字段，

珀金斯等。阿尔。实验性 [第 20 页]

RFC 3561 AODV 路由 2003 年 7 月

- 跳数设置为新跳数的值，

- 到期时间设置为当前时间加上 RREP 消息中的生命周期，

- 目标序列号是目标序列 RREP 消息中的编号。

当前节点可以随后使用此路由转发数据 到目的地的数据包。

如果当前节点不是Originator IP指示的节点 RREP 消息中的地址和转发路由已创建或 如上所述更新，节点查询其路由表条目 用于发起节点确定 RREP 的下一跳 包，然后使用 该路由表条目中的信息。如果一个节点转发一个 RREP
在可能有错误或单向的链接上， 节点应该设置“A”标志以要求接收者 RREP 通过发送 RREP-ACK 消息确认收到 RREP 返回（见第 6.8 节）。

当任何节点传输 RREP 时，该节点的前驱列表 通过添加下一个目标节点来更新相应的目标节点 RREP 转发到的跳节点。此外，在每个节点 用于转发 RREP 的（反向）路由的生命周期更改为
(existing-lifetime, (current time + ACTIVE_ROUTE_TIMEOUT）。最后，下一跳的前体列表 向目的地更新以包含前往的下一跳 来源。

6.8 . 单向链路上的操作

RREP 传输可能会失败，特别是如果 触发 RREP 的 RREQ 传输发生在单向 关联。如果同一个路由发现没有产生其他 RREP 尝试到达发起 RREQ 消息的节点， 发起者将在超时后重新尝试路由发现（请参阅 第 6.3
节）。然而，同样的场景很可能会重演 没有任何改进，即使经过也不会发现任何路线 反复重试。除非采取纠正措施，否则可能会发生这种情况 即使在始发者和目的地之间的双向路由 存在。使用 RREQ 广播传输的链路层将 无法检测到此类单向链路的存在。在
AODV，任何节点只作用于第一个具有相同 RREQ ID 和 忽略任何后续的 RREQ。例如，假设第一个

珀金斯等。阿尔。实验性 [第 21 页]

RFC 3561 AODV 路由 2003 年 7 月

RREQ 沿着具有一个或多个单向的路径到达 链接）。后续的 RREQ 可能通过双向路径到达 （假设存在这样的路径），但它将被忽略。

为了防止这个问题，当一个节点检测到它的传输 RREP 消息失败，它会记住失败的下一跳 “黑名单”集中的 RREP。此类故障可以通过 缺少链路层或网络层确认（例如，RREP- 确认）。一个节点忽略从它的任何节点收到的所有 RREQ
黑名单设置。节点从黑名单集合中删除后 BLACKLIST_TIMEOUT 期间（参见第 10 节）。应该设置这个时间段 到执行允许数量所需的时间上限 路由请求重试尝试的次数，如第 6.3 节所述。

请注意，RREP-ACK 数据包不包含任何关于 它正在确认哪个 RREP。RREP-ACK 的时间 收到的可能会在发送 RREP 之后 带有“A”位。预计这些信息足以 向 RREP 的发件人保证该链接是 目前是双向的，没有任何真正的依赖
特定的 RREP 消息被确认。然而，这种保证 通常不能指望永久有效。

6.9 . 你好消息

节点可以通过广播本地 Hello 来提供连接信息 消息。一个节点应该只使用 hello 消息，如果它是一个 活动路线。每 HELLO_INTERVAL 毫秒，节点检查 它是否发送了广播（例如，RREQ 或适当的层 2 条消息）在最后一个
HELLO_INTERVAL 中。如果没有，它可以 广播一个 TTL = 1 的 RREP，称为 Hello 消息，带有 RREP 消息字段设置如下：

      目标 IP 地址 节点的 IP 地址。

      目标序列号 节点的最新序列号。

      跳数 0

      终生 ALLOWED_HELLO_LOSS * HELLO_INTERVAL

一个节点可以通过侦听来自它的数据包来确定连通性 一组邻居。如果在过去的 DELETE_PERIOD 内，它收到了 来自邻居的 Hello 消息，然后对于该邻居没有 接收任何数据包（Hello 消息或其他）超过

珀金斯等。阿尔。实验性 [第 22 页]

RFC 3561 AODV 路由 2003 年 7 月

ALLOWED_HELLO_LOSS * HELLO_INTERVAL 毫秒，节点应该 假设到这个邻居的链接当前丢失。当这 发生时，节点应该按照第 6.11 节进行处理。

每当一个节点收到来自邻居的 Hello 消息时，该节点 应该确保它有一条到邻居的活动路由，并且 如有必要，创建一个。如果路由已经存在，则 如有必要，应增加路线的使用寿命，以达到 至少 ALLOWED_HELLO_LOSS *
HELLO_INTERVAL。去往的路线 邻居，如果存在，必须随后包含最新的 来自 Hello 消息的目标序列号。当前节点 现在可以开始使用这条路由转发数据包了。路线 由 hello 消息创建，不被任何其他活动路由使用
将有空的前体列表并且不会触发 RERR 消息 如果邻居搬走并且邻居超时发生。

6.10 . 维护本地连接

每个转发节点应该跟踪它的持续连接 到其活动的下一跳（即，哪些下一跳或前驱具有 上次转发节点转发数据包 ACTIVE_ROUTE_TIMEOUT)，以及已经传输的邻居 最后一次的问候消息 (ALLOWED_HELLO_LOSS *
HELLO_INTERVAL)。 一个节点可以维护关于其持续的准确信息 连接到这些活动的下一跳，使用一个或多个 可用的链路或网络层机制，如下所述。

- 任何合适的链路层通知，例如由 IEEE 802.11，可用于确定连接性，每次 数据包被传输到活动的下一跳。例如，缺席 发送 RTS 后链路层 ACK 或未能获得 CTS， 即使在重传尝试达到最大次数后， 表示到此活动下一跳的链路丢失。

- 如果第 2 层通知不可用，则被动确认 应该在下一跳转发时使用 数据包，通过侦听通道进行传输尝试 由下一跳制造。如果没有检测到传输 NEXT_HOP_WAIT 毫秒或下一跳是目的地（和 因此不应转发数据包）以下之一
  应该使用方法来确定连通性：

    * 接收来自下一个的任何数据包（包括 Hello 消息） 跳。

    * RREQ 单播到下一跳，请求到下一跳的路由 跳。

珀金斯等。阿尔。实验性 [第 23 页]

RFC 3561 AODV 路由 2003 年 7 月

      * ICMP Echo Request 消息单播到下一跳。

如果这些方法中的任何一种都无法检测到下一跳的链接， 转发节点应该假设链路丢失，并采取 按照第 6.11 节中规定的方法采取纠正措施。

6.11 . 路由错误 (RERR) 消息、路由到期和路由删除

通常，路由错误和断链处理需要 以下步骤：

- 使现有路线无效

- 列出受影响的目的地

- 确定哪些邻居（如果有）可能会受到影响

- 向此类邻居提供适当的 RERR

路由错误（RERR）消息可以是广播的（如果有 许多前体），单播（如果只有 1 个前体），或 迭代单播到所有前体（如果广播是 不当）。即使当 RERR 消息以迭代方式单播到 几个前体，它被认为是一个单一的控制消息 用于下文中的描述。和
这种理解，一个节点不应该产生超过 每秒 RERR_RATELIMIT RERR 消息。

节点在三种情况下发起对 RERR 消息的处理：

(i) 如果它检测到活动节点下一跳的链路中断 传输数据时在其路由表中路由（和 路由修复，如果尝试，不成功），或

(ii) 如果它得到一个数据包，它的目的地是一个节点，它 没有活动路线并且没有修复（如果 使用本地维修），或

(iii) 如果它从邻居那里收到一个或多个 RERR 活动路线。

对于情况（i），节点首先列出不可达目的地的列表 由无法到达的邻居和任何额外的本地路由表中的 目的地（或子网，参见第 7 节） 使用不可达邻居作为下一跳。在这种情况下，如果 发现子网路由新近不可达，IP 目的地 子网的地址是通过将零附加到

珀金斯等。阿尔。实验性 [第 24 页]

RFC 3561 AODV 路由 2003 年 7 月

子网前缀，如路由表条目中所示。这是 明确的，因为已知前体有路由表 该子网具有兼容前缀长度的信息。

对于情况（ii），只有一个无法到达的目的地，即 无法传递的数据包的目的地。为了 情况 (iii)，列表应包含 RERR 中的目的地 在本地路由中存在对应的条目 将接收到的 RERR 的发送器作为下一跳的表。

列表中的一些无法到达的目的地可以被使用 相邻节点，因此可能需要发送一个（新的） 恢复。RERR 应该包含那些目的地 创建的不可达目的地列表并且有一个非空 前体清单。

应该接收 RERR 的相邻节点都是那些 属于至少一个不可到达的前体列表 新创建的 RERR 中的目的地。如果只有一个 需要接收 RERR 的唯一邻居，RERR 应该是 向那个邻居单播。否则通常会发送 RERR 到本地广播地址（目标 IP
== 255.255.255.255， TTL == 1) 无法到达的目的地，以及它们对应的 目标序列号，包含在数据包中。目标计数 RERR 报文字段表示不可达数 数据包中包含的目的地。

就在传输 RERR 之前，在 可能影响目标序列号的路由表 无法到达的目的地。对于这些目的地中的每一个， 相应的路由表条目更新如下：

1.这个路由条目的目的序列号，如果它 存在且有效，在上述情况 (i) 和 (ii) 中递增， 并从上述情况 (iii) 中的传入 RERR 中复制。

2.通过将路由条目标记为无效来使条目无效

3. Lifetime 字段更新为当前时间加上 DELETE_PERIOD。 在此之前，不应删除该条目。

请注意，路由表中的 Lifetime 字段起着双重作用—— 对于活动路线，它是到期时间，对于无效路线 现在是删除时间。如果收到无效的数据包 路线，Lifetime 字段更新为当前时间加上
DELETE_PERIOD。DELETE_PERIOD 的确定在 第 10 节。

珀金斯等。阿尔。实验性 [第 25 页]

RFC 3561 AODV 路由 2003 年 7 月

6.12 . 本地维修

当活动路由中发生链路中断时，其上游节点 中断可以选择在本地修复链接，如果目的地 距离不超过 MAX_REPAIR_TTL 跳。修复链接 中断，节点增加目的地的序列号 然后为该目的地广播一个 RREQ。RREQ 的 TTL
最初应设置为以下值：

      最大（MIN_REPAIR_TTL，0.5 * #hops）+ LOCAL_ADD_TTL，

其中#hops 是到发送方（发起方）的跳数 当前无法投递的数据包。因此，本地修复尝试将 通常对发起节点不可见，并且总是有 TTL
> = MIN_REPAIR_TTL + LOCAL_ADD_TTL。启动修复的节点 然后等待发现周期接收 RREP 以响应 请求。在本地修复期间，数据包应该被缓冲。如果，在 发现期结束，修复节点还没有收到 RREP（或其他创建或更新路由的控制消息）用于 该目的地，它按照第 6.11 节中的描述进行 为该目的地发送 RERR 消息。

另一方面，如果节点收到一个或多个 RREP（或其他 控制消息创建或更新到所需的路由 目的地）在发现期间，它首先比较跳 具有跳数字段中的值的新路由的计数 该目的地的路由表条目无效。如果跳数为 新确定的到达目的地的路由大于跳数 节点应该发出
RERR 的先前已知路由的计数 目的地的消息，设置了“N”位。然后它继续 如第 6.7 节所述，更新其路由表条目 目的地。

收到带有“N”标志设置的 RERR 消息的节点不得 删除到该目的地的路线。采取的唯一行动应该是 是消息的重传，如果 RERR 从 沿着那条路线的下一跳，如果有一个或多个前兆 该路由到目的地的节点。当发起节点 接收带有“N”标志设置的
RERR 消息，如果此消息来 从沿其路由的下一跳到目的地，然后 始发节点可以选择重新启动路由发现，因为 在第 6.3 节中描述。

局部修复路由中的链路中断有时会导致增加 到这些目的地的路径长度。在本地修复链接是 可能会增加能够传输的数据包的数量 传送到目的地，因为数据包不会被丢弃 当 RERR 传播到始发节点时。发送 RERR 到

珀金斯等。阿尔。实验性 [第 26 页]

RFC 3561 AODV 路由 2003 年 7 月

本地修复链路中断后的发起节点可能允许 始发者找到一条更好的到达目的地的新路线， 基于当前节点位置。然而，它不需要 始发节点重建路由，作为始发者可能完成， 或即将完成，数据会话。

当链接沿活动路线断开时，通常会出现多个 无法到达的目的地。上游的节点 丢失的链接仅尝试立即进行本地修复 数据包前往的目的地。其他 使用相同链路的路由必须被标记为无效，但节点 处理本地修复可以标记每个这样的新丢失的路线
可本地修复；路由表中的这个本地修复标志必须是 当路线超时时重置（例如，在路线没有被 ACTIVE_ROUTE_TIMEOUT 处于活动状态）。在超时发生之前， 当数据包到达时，将根据需要修复这些其他路由
其他目的地。因此，这些路线会根据需要进行修复； 如果数据包没有到达该路由，则该路由将 无法修复。或者，根据当地的拥堵情况， 节点可以开始建立本地修复的过程 其他路由，无需等待新数据包到达。经过 主动修复因丢失而中断的线路
链接，这些路由的传入数据包将不受约束 到修复路由的延迟，可以立即转发。 但是，在收到数据包之前修复路由 冒着修复不再使用的路线的风险。 因此，取决于网络中的本地流量和 是否正在经历拥塞，节点可以选择 在收到数据包之前主动修复路由；
否则，它可以等到接收到一个数据，然后开始 路线的修复。

6.13 . 重启后的动作

参与自组织网络的节点必须采取某些行动 重新启动后，因为它可能会丢失所有序列号记录 目的地，包括它自己的序列号。然而，可能有 是使用此节点作为活动下一跳的相邻节点。 这可能会产生路由循环。为了防止这种情况 可能性，重启时的每个节点在等待
DELETE_PERIOD 之前 传输任何路由发现消息。如果节点收到 RREQ、RREP 或 RERR 控制数据包，它应该创建路由条目作为 适当给定控制中的序列号信息 包，但不得转发任何控制包。如果节点 接收到某个其他目的地的数据包，它应该
如第 6.11 小节所述广播一个 RERR并且必须重置 等待计时器在当前时间加上 DELETE_PERIOD 后到期。

珀金斯等。阿尔。实验性 [第 27 页]

RFC 3561 AODV 路由 2003 年 7 月

可以证明 [ 4 ] 到重新启动的节点退出时 等待阶段并再次成为活动路由器，它的任何一个 邻居将不再使用它作为活动的下一跳。它自己的 一旦收到来自任何其他人的 RREQ，序列号就会更新 节点，因为 RREQ 总是携带最大目标序列
途中看到的号码。如果没有这样的 RREQ 到达，节点必须 将自己的序列号初始化为零。

6.14 . 接口

因为 AODV 应该可以在有线和无线上平稳运行， 网络，并且因为很可能 AODV 也将用于 多个无线设备，特定的接口 每当接收到数据包时，AODV 都必须知道数据包到达。 这包括接收 RREQ、RREP 和 RERR 消息。
每当收到来自新邻居的数据包时，接口上的 接收到的数据包被记录到路由表条目中 对于该邻居，以及所有其他适当的路由 信息。类似地，每当通往新目的地的路线是 学习，通过它可以到达目的地的界面 也被记录到目的地的路由表条目中。

当有多个接口可用时，节点重传RREQ 消息在所有已发送的接口上重新广播该消息 配置为在 ad-hoc 网络中运行，除了那些 已知所有节点的邻居都已经收到 RREQ 例如，对于某些广播媒体（例如以太网），它可能
假设同一链路上的所有节点都收到广播 同时留言。当一个节点需要发送一个 RERR 时，它 应该只在那些有相邻接口的接口上传输它 该路由的前驱节点。

7 . AODV 和聚合网络

AODV 设计用于具有 IP 地址的移动节点 不一定相互关联，以创建临时 网络。然而，在某些情况下，移动节点的集合可能 彼此之间以固定的关系运作并共享一个共同点 子网前缀，在一个自组织网络的区域内一起移动
已经形成。将这样的节点集合称为“子网”。在这 在这种情况下，子网内的单个节点可能会进行广告 子网上所有其他节点的可达性，通过响应 RREP 消息到任何请求路由到任何节点的 RREQ 消息 子网路由前缀。将单个节点称为“子网路由器”。
为了让子网路由器运行 AODV 协议， 整个子网，它必须维护一个目标序列号 整个子网。在子网发送的任何此类 RREP 消息中 路由器，RREP 消息的前缀大小字段必须设置为

珀金斯等。阿尔。实验性 [第 28 页]

RFC 3561 AODV 路由 2003 年 7 月

子网前缀的长度。共享子网前缀的其他节点 不应该发出 RREP 消息，并且应该将 RREQ 消息转发到 子网路由器。

为子网提供路由的 RREP 的处理（即，具有 非零前缀长度）与特定于主机的处理相同 RREP 消息。每个接收带有前缀大小的 RREP 的节点 信息应该创建或更新路由表条目 子网，包括子网路由器提供的序列号， 并包括适当的前体信息。然后，在
未来节点可以使用该信息来避免发送未来的 RREQ 对于同一子网上的其他节点。

当节点使用子网路由时，数据包可能被路由到 子网上未分配给任何现有节点的 IP 地址 在 ad hoc 网络中。发生这种情况时，子网路由器必须 向发送节点返回 ICMP Host Unreachable 消息。上游的 收到这样的 ICMP
消息的节点应该记录信息 特定的 IP 地址无法访问，但不得 使任何匹配子网前缀的路由条目无效。

如果子网中的多个节点向子网通告可达性 由子网前缀定义，具有最低 IP 地址的节点是 被选为子网路由器，所有其他节点必须停止 广告可达性。

默认路由的行为（即带有路由前缀的路由 长度 0) 在本规范中没有定义。路线选择 共享前缀位应首先根据最长匹配。

8 . 将 AODV 与其他网络一起使用

在某些配置中，ad hoc 网络可能能够提供 不使用 AODV 的外部路由域之间的连接。 如果与其他网络的联系点可以充当子网 路由器（见第 7 节）用于外部网络中的任何相关网络 路由域，那么自组织网络可以保持与
外部路由域。事实上，外部路由网络 可以使用AODV定义的ad hoc网络作为中转网络。

为了提供此功能，与外部的联系点 网络（称之为基础设施路由器）必须充当子网 外部网络中每个感兴趣的子网的路由器 基础设施路由器可以提供哪些可达性。这 包括需要维护目标序列号 那个外部子网。

珀金斯等。阿尔。实验性 [第 29 页]

RFC 3561 AODV 路由 2003 年 7 月

如果多个基础设施路由器提供对相同 外部子网，那些基础设施路由器必须合作（通过 表示超出本规范的范围）以提供一致的 用于对这些子网进行临时访问的 AODV 语义。

9 . 扩展

在本节中，对 RREQ 和 RREP 的扩展格式 消息被指定。所有此类扩展都出现在消息之后 数据，并具有以下格式：

    0 1 2 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 类型 | 长度 | 特定于类型的数据...
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+

在哪里：

1-255型

Length 类型特定数据的长度，不包括Type 和以字节为单位的扩展的长度字段。

不能跳过类型介于 128 和 255 之间的扩展。这 扩展规则将被更完整地阐明，并符合 处理 IPv6 选项的规则。

9.1 . 你好间隔扩展格式

    0 1 2 3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1

++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | 类型 | 长度 | 你好间隔... |
++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- ++-+-+-+-+-+-+-+ | ... 你好间隔，继续 | ++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

类型 1

长度 4

你好间隔 连续传输之间的毫秒数 一个 Hello 消息。

珀金斯等。阿尔。实验性 [第 30 页]

RFC 3561 AODV 路由 2003 年 7 月

Hello Interval 扩展可以附加到 RREP 消息中 TTL == 1，由相邻接收器使用以确定多长时间 等待后续此类 RREP 消息（即 Hello 消息；请参阅 第 6.9 节）。

10 . 配置参数

本节给出了一些重要参数的默认值 与 AODV 协议操作相关联。特定的移动节点 可能希望更改某些参数，特别是 NET_DIAMETER、MY_ROUTE_TIMEOUT、ALLOWED_HELLO_LOSS、RREQ_RETRIES 和
可能是 HELLO_INTERVAL。在后一种情况下，节点应该 在它的 Hello 消息中通告 HELLO_INTERVAL，通过附加一个 RREP 消息的问候间隔扩展。选择这些 参数可能会影响协议的性能。改变
NODE_TRAVERSAL_TIME 也会改变节点对 NET_TRAVERSAL_TIME，因此只有具备适当的知识才能完成 关于 ad hoc 网络中其他节点的行为。这 MY_ROUTE_TIMEOUT 的配置值必须至少为 2 *
PATH_DISCOVERY_TIME。

参数名称值
   --------------- -----
ACTIVE_ROUTE_TIMEOUT 3,000 毫秒 ALLOWED_HELLO_LOSS 2 BLACKLIST_TIMEOUT RREQ_RETRIES * NET_TRAVERSAL_TIME DELETE_PERIOD
请参阅下面的注释 HELLO_INTERVAL 1,000 毫秒 LOCAL_ADD_TTL 2 MAX_REPAIR_TTL 0.3 * NET_DIAMETER MIN_REPAIR_TTL 见下面的注释
MY_ROUTE_TIMEOUT 2 * ACTIVE_ROUTE_TIMEOUT 净直径 35 NET_TRAVERSAL_TIME 2 * NODE_TRAVERSAL_TIME * NET_DIAMETER NEXT_HOP_WAIT
NODE_TRAVERSAL_TIME + 10 NODE_TRAVERSAL_TIME 40 毫秒 PATH_DISCOVERY_TIME 2 * NET_TRAVERSAL_TIME RERR_RATELIMIT 10
RING_TRAVERSAL_TIME 2 * NODE_TRAVERSAL_TIME *
(TTL_VALUE + TIMEOUT_BUFFER)
RREQ_RETRIES 2 RREQ_RATELIMIT 10 TIMEOUT_BUFFER 2 TTL_开始 1 TTL_INCREMENT 2 TTL_THRESHOLD 7 TTL_VALUE 见下面的注释

珀金斯等。阿尔。实验性 [第 31 页]

RFC 3561 AODV 路由 2003 年 7 月

MIN_REPAIR_TTL 应该是最后一个已知的跳数 目的地。如果使用 Hello 消息，则 ACTIVE_ROUTE_TIMEOUT 参数值必须大于该值
(ALLOWED_HELLO_LOSS * HELLO_INTERVAL)。对于给定的 ACTIVE_ROUTE_TIMEOUT 值，这可能需要对 HELLO_INTERVAL 的值，因此使用 Hello Hello 消息中的间隔扩展。

TTL_VALUE 是 IP 头中 TTL 字段的值，而 正在执行扩展环搜索。这将进一步描述 在第 6.4 节中。TIMEOUT_BUFFER 是可配置的。它的目的是 为超时提供缓冲区，以便如果 RREP 延迟 由于拥塞，在 RREP
时发生超时的可能性较小 仍在返回源头的途中。要省略此缓冲区，请设置 TIMEOUT_BUFFER = 0。

DELETE_PERIOD 旨在提供时间的上限 上游节点 A 可以有一个邻居 B 作为活动的下一跳 对于目的地 D，而 B 已使到 D 的路线无效。 超越 这一次 B 可以删除到 D 的（已经失效的）路由。 上限的确定在某种程度上取决于
底层链路层的特性。如果 Hello 消息是 用于确定下一跳链路的持续可用性 节点，DELETE_PERIOD 必须至少为 ALLOWED_HELLO_LOSS *
你好_时间间隔。如果链路层反馈用于检测丢失 链接，DELETE_PERIOD 必须至少为 ACTIVE_ROUTE_TIMEOUT。如果你好 从邻居接收消息，但数据包 邻居丢失（例如，由于临时链路不对称），我们必须
对底层链路层做更具体的假设。我们 假设这种不对称不能持续超过一定时间，例如， HELLO_INTERVAL 的倍数 K。换句话说，一个节点将 总是至少收到 K 个后续 Hello 消息中的一个 来自邻居，如果链路正常工作并且邻居发送不
其他交通。涵盖所有可能，

      DELETE_PERIOD = K * 最大值（ACTIVE_ROUTE_TIMEOUT，HELLO_INTERVAL）
                         （推荐 K = 5）。

NET_DIAMETER 测量两个之间的最大可能跳数 网络中的节点。NODE_TRAVERSAL_TIME 是保守估计 数据包的平均一跳遍历时间，应包括 排队延迟、中断处理时间和传输时间。 ACTIVE_ROUTE_TIMEOUT
应该设置为更长的值（至少 10,000 毫秒）如果链路层指示用于检测链路 IEEE 802.11 [ 5 ] 标准中的破坏。TTL_START 应该是 如果 Hello 消息用于本地连接，则设置为至少 2 信息。AODV 协议的性能对
这些常数的选择值，通常取决于

珀金斯等。阿尔。实验性 [第 32 页]

RFC 3561 AODV 路由 2003 年 7 月

底层链路层协议的特性，无线电 技术等 BLACKLIST_TIMEOUT 应适当增加，如果 使用扩展环搜索。在这种情况下，应该 {[(TTL_THRESHOLD - TTL_START)/TTL_INCREMENT] + 1 +
RREQ_RETRIES} *
NET_TRAVERSAL_TIME。这是为了考虑可能的额外路线 发现尝试。

11 . 安全注意事项

目前，AODV 没有规定任何特殊的安全措施。路线 然而，协议是模拟攻击的主要目标。在 节点成员身份未知的网络，很难 确定冒充攻击的发生，以及安全性 预防技术充其量是困难的。然而，当 网络成员身份已知并且存在此类攻击的危险， AODV
控制消息必须通过使用身份验证来保护 技术，例如涉及生成不可伪造和 加密强消息摘要或数字签名。 虽然 AODV 对认证没有限制 用于此目的的机制，IPsec AH 是一个合适的选择 对于节点共享适当的安全关联的情况 允许使用AH。

特别是，RREP 消息应该被认证以避免 创建到达所需目的地的虚假路线。否则，一个 攻击者可以伪装成所需的目的地，并恶意地 拒绝向目的地提供服务和/或恶意检查和 消耗旨在交付到目的地的流量。恢复率 消息虽然不那么危险，但应该进行身份验证，以便
防止恶意节点破坏节点之间的有效路由 是通信伙伴。

AODV 不对地址的方法做出任何假设 被分配给移动节点，除了它们被假定为 拥有唯一的 IP 地址。因此，没有特别考虑，其他 由于通用协议规范，这是自然的， 可以对IPsec认证头的适用性做出说明 或密钥交换机制。但是，如果广告中的移动节点
hoc 网络已经预先建立了安全关联，它是 假定安全关联的目的 创建包括授权处理AODV控制 消息。鉴于这种理解，移动节点应该能够 根据 IP 地址使用相同的身份验证机制 因为他们本来会使用其他方式。

珀金斯等。阿尔。实验性 [第 33 页]

RFC 3561 AODV 路由 2003 年 7 月

12 . IANA 考虑事项

AODV 为发送到端口 654 的消息定义了一个“类型”字段。 已为此 Type 字段的值创建了注册表，并且 已分配以下值：

      消息类型值
      --------------------------- -----
      路由请求 (RREQ) 1
      路由回复 (RREP) 2
      路由错误 (RERR) 3
      路由应答确认 (RREP-ACK) 4

AODV 控制消息可以有扩展名。目前，只有一个 扩展名被定义。已为类型创建了一个新的注册表 扩展领域：

      扩展类型值
      --------------------------- -----
      你好间隔1

可以分配消息类型或扩展类型的未来值 使用标准动作 [ 2 ]。

13 . IPv6 注意事项 IPv6 的详细操作 请参见[ 6 ]。唯一的变化 协议是地址字段被放大。

14 . 致谢

特别感谢 UCSB 的 Ian Chakeres 提出的广泛建议 以及对最近修订的贡献。

我们感谢大学所做的工作 Carl Gunter 团队中的宾夕法尼亚州，以及斯坦福大学和 CMU，以确定某些条件（特别是涉及重新启动和 丢失了 RERR），在这种情况下，AODV 的先前版本可能会遭受 路由环路。这些努力的贡献者包括
Karthikeyan 巴尔加文、约书亚·布洛赫、戴夫·马尔茨、马丹拉尔·穆苏瓦蒂和达沃 奥布拉多维奇。DELETE_PERIOD 的想法，过期路由 （尤其是序列号）到特定的 目的地必须保持，也是他们建议的。

我们也承认 Sung- 提出的意见和改进 Ju Lee (特别是关于本地维修), Mahesh Marina, Erik Nordstrom（为第 6.11 节提供文本），Yves Prelot，Marc Mosko、Manel
Guerrero Zapata、Philippe Jacquet 和 Fred Baker。

珀金斯等。阿尔。实验性 [第 34 页]

RFC 3561 AODV 路由 2003 年 7 月

15 . 规范参考

[ 1 ] Bradner, S. “在 RFC 中用于指示需求的关键词 级别”，BCP 14，RFC 2119，1997年 3 月。

[ 2 ] Narten, T. 和 H. Alvestrand，“编写 IANA 的指南 RFC 中的注意事项部分”，BCP 26，RFC 2434，1998年 10 月。

16 . 参考资料

[ 3 ] Manner, J. 等人，“移动相关术语”，Work in 进展，2001 年 7 月。

[ 4 ] Karthikeyan Bhargavan、Carl A. Gunter 和 Davor Obradovic。 故障源判定。在研讨会论文集 软件实践中的正式方法，俄勒冈州波特兰，2000 年 8 月。

[ 5 ] IEEE 802.11 委员会，AlphaGraphics #35，10201 N.35th Avenue， Phoenix AZ 85051. 无线局域网媒体访问控制 MAC 和 物理层 PHY 规范，1997 年 6
月。IEEE 标准 802.11-97。

[ 6 ] Perkins, C.、Royer, E. 和 S. Das，“Ad hoc on demand distance ip 版本 6 的矢量 (AODV) 路由，正在进行中。

珀金斯等。阿尔。实验性 [第 35 页]

RFC 3561 AODV 路由 2003 年 7 月

17 . 作者地址

查尔斯·E·帕金斯 通信系统实验室 诺基亚研究中心 313 仙童驱动器 山景城，加利福尼亚州 94303 美国

电话：+1 650 625 2986 传真：+1 650 691 2170（传真） 电子邮件：Charles.Perkins@nokia.com

Elizabeth M. Belding-Royer 计算机科学系 加州大学圣巴巴拉分校 加利福尼亚州圣巴巴拉市 93106

电话：+1 805 893 3411 传真：+1 805 893 8553 电子邮箱：ebelding@cs.ucsb.edu

萨米尔·达斯 电气与计算机工程系 ＆ 计算机科学 辛辛那提大学 辛辛那提，俄亥俄州 45221-0030

电话：+1 513 556 2594 传真：+1 513 556 7326 电子邮件：sdas@ececs.uc.edu

珀金斯等。阿尔。实验性 [第 36 页]

RFC 3561 AODV 路由 2003 年 7 月

18 . 完整的版权声明

版权所有 (C) 互联网协会 (2003)。版权所有。

本文件及其翻译可以复制并提供给 其他，以及对其进行评论或以其他方式解释的衍生作品 或协助其实施可以准备、复制、出版 并全部或部分分发，不受任何限制 种类，前提是上述版权声明和本段是 包括在所有此类副本和衍生作品中。然而，这
不得以任何方式修改文档本身，例如通过删除 版权声明或对互联网协会或其他 互联网组织，除非出于以下目的而需要 制定互联网标准，在这种情况下，程序 Internet 标准过程中定义的版权必须是 遵循，或根据需要将其翻译成其他语言 英语。

以上授予的有限权限是永久的，不会 被互联网协会或其继承者或受让人撤销。

本文档和其中包含的信息是在 “原样”基础和互联网社会和互联网工程 特遣部队否认所有明示或暗示的保证，包括 但不限于任何保证信息的使用 此处不会侵犯任何权利或任何暗示的保证 特定用途的适销性或适用性。

致谢

RFC 编辑器功能的资金目前由 互联网协会。

珀金斯等。阿尔。实验性 [第 37 页]